version: 2.1

setup: true

orbs:
  path-filtering: circleci/path-filtering@1.0.0 #TODO check latest version

workflows:
  always-run:
    jobs:
    - path-filtering/filter:
        filters:
          branches:
            only:
            - ${CIRCLE_BRANCH}
            ignore:
            - main

        name: check-updated-files-feature
        # <regex path-to-test> <parameter-to-set> <value-of-pipeline-parameter>
        mapping: |
          restaurant/.* run-test-service true
          recipes/.* run-test-service true
          .circleci/.* run-test-service true
        base-revision: main
        config-path: .circleci/feature_config.yml
    - path-filtering/filter:
        filters:
          branches:
            only:
            - main
        name: check-updated-files-main
        mapping: |
          restaurant/.* run-test-service true
          recipes/.* run-test-service true
        base-revision: main
        config-path: .circleci/main_config.yml

