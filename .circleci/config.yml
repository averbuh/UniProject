version: 2.1

setup: true

orbs:
  path-filtering: circleci/path-filtering@1.0.0


workflows:
  feature-dev-stage-prod:
    jobs:
    - path-filtering/filter:
        filters:
          branches:
            ignore:
            - dev
            - main
            - /.*release$/
            - /.*hotfix.*/
        name: Push to Feature branch
        config-path: .circleci/feature_config.yml
        base-revision: HEAD
        mapping: |
          recipes/.*\.go$ run-recipes-go true
          suppliers/.*\.go$ run-suppliers-go true
    - path-filtering/filter:
        filters:
          branches:
            only:
            - dev
        name: Push to Development branch
        config-path: .circleci/dev_config.yml
        base-revision: HEAD
        mapping: |
          .circleci/dev_config.yml run-recipes-go true
          .circleci/dev_config.yml run-suppliers-go true
          helm_charts/* run-recipes-go true
          recipes/.*\.go$ run-recipes-go true
          suppliers/.*\.go$ run-suppliers-go true
          .circleci/config.yml run-recipes-go true
#           .* run-recipes-go true
#           .* run-suppliers-go true
          
    - path-filtering/filter:
        filters:
          branches:
            only:
              - main 
        name: Push to Main branch
        config-path: .circleci/main_config.yml
        base-revision: HEAD
        mapping: |
          .circleci/main_config.yml run-pipeline true
          .circleci/dev_config.yml run-pipeline true
          .circleci/config.yml run-pipeline true

    - path-filtering/filter:
        filters:
          branches:
            only:
              - /.*release$/
        name: Push to Release branch
        config-path: .circleci/release_config.yml
        base-revision: HEAD
        mapping: |
          .circleci/main_config.yml run-pipeline true
          .circleci/dev_config.yml run-pipeline true
          .circleci/config.yml run-pipeline true


# fsd