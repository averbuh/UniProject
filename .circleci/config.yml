version: 2.1

setup: true

orbs:
  path-filtering: circleci/path-filtering@1.0.0


workflows:
  feature-dev-stage-prod:
    jobs:
    - path-filtering/filter:
        filters:
          branches:
            only:
            - /^feature\/.*/
        name: Push to Feature branch
        config-path: .circleci/feature_config.yml
        base-revision: HEAD
        mapping: |
          recipes/.*\.go$ run-recipes-go true
          suppliers/.*\.go$ run-suppliers-go true
          .* run-recipes-go true
          .* run-suppliers-go true


    - path-filtering/filter:
        filters:
          branches:
            only:
            - dev
        name: Push to Development branch
        config-path: .circleci/dev_config.yml
        base-revision: HEAD
        mapping: |
          recipes/.*\.go$ run-recipes-go true
          suppliers/.*\.go$ run-suppliers-go true
          .* run-recipes-go true
          .* run-suppliers-go true



    - path-filtering/filter:
        filters:
          branches:
            only:
              - /^release\/v.*/

        name: Push to Release branch
        config-path: .circleci/release_config.yml
        base-revision: HEAD
        mapping: |
          .* run-recipes-go true
          .* run-suppliers-go true

          

    - path-filtering/filter:
        filters:
          branches:
            only:
              - main 
        name: Push to Main branch
        config-path: .circleci/main_config.yml
        base-revision: HEAD
        mapping: |
          .* run-recipes-go true
          .* run-suppliers-go true

