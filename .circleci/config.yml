version: 2.1

setup: true

orbs:
  path-filtering: circleci/path-filtering@1.0.0


workflows:
  feature-dev-stage-prod:
    jobs:
    - path-filtering/filter:
        filters:
          branches:
            only: dev
        name: Push to Feature branch
        config-path: .circleci/feature_config.yml
        base-revision: dev
        mapping: |
          recipes/.*\.go$ run-recipes-go true
          recipes/.*\.go$ service-path "recipes"
          suppliers/.*\.go$ run-suppliers-go true
          suppliers/.*\.go$ service-path "suppliers"
    - path-filtering/filter:
        filters:
          branches:
            only: release
            ignore:
            - dev
            - main
        name: Push to Development branch
        config-path: .circleci/dev_config.yml
